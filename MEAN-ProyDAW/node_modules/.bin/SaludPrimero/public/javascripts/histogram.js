
function definirRangosBusqueda() {
  var pri_reporte = document.getElementById("pri-reporte");
  if (pri_reporte.checked) {
    $("#acordeon").hide(1000);
  }else {      
    $("#acordeon").show(1000);
  }  
}

function aleatorio(inferior, superior){
  numPosibilidades = superior - inferior;
  aleat = Math.random() * numPosibilidades;
  aleat = Math.floor(aleat);
  return parseInt(inferior) + aleat;
}

function colorAleatorio() {
  var hexadecimal = new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F");
  color_aleatorio = "#";
  for (i=0; i<6; i++) {
    posarray = aleatorio(0, hexadecimal.length);
    color_aleatorio += hexadecimal[posarray];
  }
  return color_aleatorio;
}

function nombresLaboratorios() {
  var url = '/laboratorios';
  $.ajax({
    type: 'GET',
    url: url,
    success: function(laboratorios) {         
      $.each(laboratorios, function(i, item) {        
        total.push(item.nombre);        
      });      
    }    
  });  
}

function reporteEstadisticoPastel() {
  var url1 = '/laboratorios';
  var url2 = '/muestras';  
  $.ajax({
    type: 'GET',
    url: url1,
    success: function(laboratorios) {
      $.ajax({
        type: 'GET',
        url: url2,
        success: function(muestras) {
          var muestrasXLaboratorio = [];
          var nombresLab = [];          
          var datos = [];
          var contador = 0;
          $.each(laboratorios, function(i, laboratorio) {
            nombresLab.push(laboratorio.nombre);
          });

          console.log('Nombres de todos los laboratorios: ' + nombresLab);
          $.each(nombresLab, function(j, nombreLab) {            
            $.each(muestras, function(k, muestra) {
              if (muestra.lab_asignado == nombreLab) {
                contador++;
              }
            });
            console.log('Total de muestras en el laboratorio ' + nombreLab + ': ' + contador);
            muestrasXLaboratorio.push(contador);
            contador = 0;
          });
          $.each(muestrasXLaboratorio, function(i, muestraXLab) {
            var conteo = muestraXLab;
            datos.push({value: conteo, color: colorAleatorio(), 
              highlight: 'rgba(73,206,180,0.6)', label: nombresLab[i]});
          });
          var contexto = document.getElementById("grafico").getContext("2d");
          window.Pie = new Chart(contexto).Pie(datos);
        }
      });
    }
  });
}

function reporteEstadisticoBarra() {
  var url = '/muestras/muestrasPorRangoFechas';
  $.ajax({      
    type:'GET', 
    url: url,     
    success:function(muestras) {         
      var datos = {
        type: 'doughnut',
        labels : ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],                
        datasets: [{
        fillColor: 'rgba(91,228,146,0.6)',
        strokeColor: 'rgba(57,194,112,0.7)',
        highlightFill: 'rgba(73,206,180,0.6)', //COLOR "HOVER" DE LAS BARRAS
        highlightStroke: 'rgba(66,196,157,0.7)', //COLOR "HOVER" DEL BORDE 
        pointColor: "rgba(220,220,220,1)",
        pointStrokeColor: "#fff",
        data: [50, 80, 20, 35, 60, 90, 100, 10, 30, 45, 75, 65]
         }, {
        fillColor: "rgba(252,147,65,0.5)",
        strokeColor: "rgba(255,255,255,1)",
        highlightFill: 'rgba(73,206,180,0.6)', //COLOR "HOVER" DE LAS BARRAS
        highlightStroke: 'rgba(66,196,157,0.7)', //COLOR "HOVER" DEL BORDE
        pointColor: "rgba(173,173,173,1)",
        pointStrokeColor: "#fff",
        data: [90, 56, 34, 35, 67, 12, 2, 30, 3, 4, 16, 1]
         }, {
        fillColor: "rgba(252,147,65,0.5)",
        strokeColor: "rgba(255,255,255,1)",
        highlightFill: 'rgba(73,206,180,0.6)', //COLOR "HOVER" DE LAS BARRAS
        highlightStroke: 'rgba(66,196,157,0.7)', //COLOR "HOVER" DEL BORDE
        pointColor: "rgba(173,173,173,1)",
        pointStrokeColor: "#fff",
        data: [78, 19, 3, 17, 18, 2, 26, 59, 88, 56, 24, 12]
         }, {
        fillColor: "rgba(252,147,65,0.5)",
        strokeColor: "rgba(255,255,255,1)",
        highlightFill: 'rgba(73,206,180,0.6)', //COLOR "HOVER" DE LAS BARRAS
        highlightStroke: 'rgba(66,196,157,0.7)', //COLOR "HOVER" DEL BORDE
        pointColor: "rgba(173,173,173,1)",
        pointStrokeColor: "#fff",
        data: [100, 80, 40, 35, 70, 50, 40, 30, 70, 45, 75, 95]
         }] 
      }
      var contexto = document.getElementById('grafico').getContext('2d');
      window.Barra = new Chart(contexto).Bar(datos, { responsive : true });
    }      
  });  
}

$("#boton").click(function() {
  var rep = document.getElementById("grafico");
  rep.parentNode.removeChild(rep);
  var pri_reporte = document.getElementById("pri-reporte");
  var graph = document.getElementById("graph");  
  rep = document.createElement("canvas");  
  rep.id = "grafico";
  graph.appendChild(rep);
  if (pri_reporte.checked) {
    reporteEstadisticoPastel();
  }else {
    reporteEstadisticoBarra();     
  }
  return false;
});

